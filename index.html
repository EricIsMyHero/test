<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <title>2D GÃ¼llÉ™ SÃ¼rÉ™t SimulyasiyasÄ±</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background:#fafafa; }
    h2 { margin-bottom: 10px; }
    .controls { margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; }
    .controls label { font-size: 14px; }
    .controls button { padding: 6px 14px; cursor: pointer; }

    #gridContainer {
      position: relative;
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 1cm;
      grid-template-rows: repeat(5, 1cm);
      border: 2px solid #222;
      height: 5cm;
      margin-bottom: 20px;
      overflow: hidden;
      background: linear-gradient(#f9f9f9, #f1f1f1);
    }

    #gridContainer::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(to right, #ccc 1px, transparent 1px),
        linear-gradient(to bottom, #ccc 1px, transparent 1px);
      background-size: 1cm 1cm;
      pointer-events: none;
    }

    .bullet {
      position: absolute;
      height: 0.8cm;
      background: linear-gradient(90deg, #ff4d4d, #b30000);
      border-radius: 4px;
      box-shadow: 0 0 6px rgba(255,0,0,0.6);
    }

    .hidden { display: none; }

    #stats {
      border: 1px solid #444;
      padding: 15px;
      width: 360px;
      background: #fff;
    }
  </style>
</head>
<body>

<h2>GÃ¼llÉ™ SÃ¼rÉ™t SimulyasiyasÄ± (2D â€“ SeriyalÄ± AtÄ±ÅŸ)</h2>

<div class="controls">
  <label>GÃ¼llÉ™nin eni (sm): <input type="number" id="bulletWidth" value="1" min="1"></label>
  <label>Maksimum mÉ™safÉ™ (sm): <input type="number" id="distance" value="100" min="1"></label>
  <label>SÃ¼rÉ™t (sm/s): <input type="number" id="speed" value="50" min="1"></label>
  <label>GÃ¼llÉ™ sayÄ± (seriya): <input type="number" id="bulletCount" value="4" min="1"></label>
  <label>Ä°ki gÃ¼llÉ™ arasÄ± vaxt (s): <input type="number" id="delay" value="0.5" min="0" step="0.1"></label>
  <label>Seriyalar arasÄ± vaxt (s): <input type="number" id="seriesDelay" value="2" min="0" step="0.1"></label>
  <button id="startBtn">BaÅŸlat</button>
  <button id="stopBtn">DayandÄ±r</button>
</div>

<div id="gridContainer"></div>

<div id="stats" class="hidden">
  <h3>ğŸ“Š Statistika (ilk seriya Ã¼zrÉ™)</h3>
  <p id="statDistance"></p>
  <p id="statSpeed"></p>
  <p id="statBulletCount"></p>
  <p id="statDelay"></p>
  <p><strong>Vaxta gÃ¶rÉ™ atÄ±lan gÃ¼llÉ™lÉ™r:</strong></p>
  <ul>
    <li id="stat1s"></li>
    <li id="stat5s"></li>
    <li id="stat10s"></li>
  </ul>
  <h4>ğŸ“ˆ Qrafik (Zaman â†’ GÃ¼llÉ™ sayÄ±)</h4>
  <canvas id="chart" width="340" height="200" style="border:1px solid #ccc"></canvas>
</div>

<script>
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const grid = document.getElementById("gridContainer");
const stats = document.getElementById("stats");

let activeIntervals = [];
let activeTimeouts = [];
let firedTimestamps = [];
let stopped = false;

startBtn.addEventListener("click", () => {
  activeIntervals.forEach(i => clearInterval(i));
  activeTimeouts.forEach(t => clearTimeout(t));
  activeIntervals = [];
  activeTimeouts = [];
  firedTimestamps = [];
  stopped = false;

  grid.innerHTML = "";
  stats.classList.add("hidden");

  const bulletWidth = Number(document.getElementById("bulletWidth").value);
  const distance = Number(document.getElementById("distance").value);
  const speed = Number(document.getElementById("speed").value);
  const bulletCount = Number(document.getElementById("bulletCount").value);
  const delay = Number(document.getElementById("delay").value);
  const seriesDelay = Number(document.getElementById("seriesDelay").value);

  grid.style.width = `${distance}cm`;

  const seriesStartTime = performance.now();
  let firstSeriesDone = false;

  function startSeries() {
    if (stopped) return;
    let finished = 0;

    for (let i = 0; i < bulletCount; i++) {
      const timeout = setTimeout(() => {
        if (stopped) return;

        if (!firstSeriesDone) {
          firedTimestamps.push((performance.now() - seriesStartTime) / 1000);
        }

        createAndMoveBullet(bulletWidth, distance, speed, () => {
          finished++;
          if (finished === bulletCount) {
            if (!firstSeriesDone) {
              firstSeriesDone = true;
              showFirstSeriesStats(distance, speed, bulletCount, delay);
            }
            const next = setTimeout(startSeries, seriesDelay * 1000);
            activeTimeouts.push(next);
          }
        });
      }, i * delay * 1000);

      activeTimeouts.push(timeout);
    }
  }

  startSeries();
});

stopBtn.addEventListener("click", () => {
  stopped = true;
  activeIntervals.forEach(i => clearInterval(i));
  activeTimeouts.forEach(t => clearTimeout(t));
  activeIntervals = [];
  activeTimeouts = [];
});

function createAndMoveBullet(width, distance, speed, onFinish) {
  const bullet = document.createElement("div");
  bullet.className = "bullet";
  bullet.style.width = `${width}cm`;

  // BÃœTÃœN GÃœLLÆLÆR EYNÄ° TRAYEKTORÄ°YA VÆ EYNÄ° SIRADA
  // Orta zolaq (mÉ™sÉ™lÉ™n 3-cÃ¼ sÄ±ra)
  const fixedLane = 2; // 0-dan baÅŸladÄ±ÄŸÄ± Ã¼Ã§Ã¼n 3-cÃ¼ sÄ±ra
  bullet.style.top = `${fixedLane + 0.1}cm`;
  bullet.style.left = "0cm";

  grid.appendChild(bullet);

  let position = 0;
  const stepTime = 20;
  const stepDistance = speed * (stepTime / 1000);

  const interval = setInterval(() => {
    position += stepDistance;
    if (position >= distance) {
      position = distance;
      clearInterval(interval);
      onFinish();
    }
    bullet.style.left = `${position}cm`;
  }, stepTime);

  activeIntervals.push(interval);
}

function showFirstSeriesStats(distance, speed, bulletCount, delay) {
  document.getElementById("statDistance").innerText = `MÉ™safÉ™: ${distance} sm`;
  document.getElementById("statSpeed").innerText = `SÃ¼rÉ™t: ${speed} sm/s`;
  document.getElementById("statBulletCount").innerText = `Ä°lk seriyada gÃ¼llÉ™ sayÄ±: ${bulletCount}`;
  document.getElementById("statDelay").innerText = `Ä°ki gÃ¼llÉ™ arasÄ± vaxt: ${delay} s`;

  const countAt = (sec) => firedTimestamps.filter(t => t <= sec).length;
  document.getElementById("stat1s").innerText = `1 saniyÉ™dÉ™: ${countAt(1)} gÃ¼llÉ™`;
  document.getElementById("stat5s").innerText = `5 saniyÉ™dÉ™: ${countAt(5)} gÃ¼llÉ™`;
  document.getElementById("stat10s").innerText = `10 saniyÉ™dÉ™: ${countAt(10)} gÃ¼llÉ™`;

  drawChart();
  stats.classList.remove("hidden");
}

function drawChart() {
  const canvas = document.getElementById("chart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (firedTimestamps.length === 0) return;

  const maxTime = Math.max(...firedTimestamps);
  const maxBullets = firedTimestamps.length;

  ctx.beginPath();
  ctx.moveTo(30, canvas.height - 20);
  ctx.lineTo(30, 10);
  ctx.moveTo(30, canvas.height - 20);
  ctx.lineTo(canvas.width - 10, canvas.height - 20);
  ctx.stroke();

  ctx.beginPath();
  firedTimestamps.forEach((t, i) => {
    const x = 30 + (t / maxTime) * (canvas.width - 50);
    const y = canvas.height - 20 - ((i + 1) / maxBullets) * (canvas.height - 40);
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  });
  ctx.stroke();
}
</script>

</body>
</html>
